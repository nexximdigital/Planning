<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Planning Gantt</title>
  <link rel="stylesheet" href="https://unpkg.com/frappe-gantt/dist/frappe-gantt.css">
  <style>
    body { font-family: Arial, sans-serif; }
    #gantt { border: 1px solid #ccc; height: 600px; } /* Hauteur fixée */
  </style>
</head>
<body>
  <div id="gantt"></div>

  <script src="https://unpkg.com/frappe-gantt/dist/frappe-gantt.umd.js"></script>
  <script>
    // Récupération du paramètre "data" dans l'URL
    function getURLParameter(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    const encodedData = getURLParameter('data');

    if (encodedData) {
      // Décoder le JSON
      const taches = JSON.parse(atob(encodedData));

      // Calculer la date min et max
      let minDate = null;
      let maxDate = null;

      taches.forEach(t => {
        const start = new Date(t.start);
        const end = new Date(t.end);

        if (!minDate || start < minDate) minDate = start;
        if (!maxDate || end > maxDate) maxDate = end;
      });

      // Ajouter une marge de 2 mois avant et après
      minDate.setMonth(minDate.getMonth() - 2);
      maxDate.setMonth(maxDate.getMonth() + 2);

      // Créer le Gantt avec les dates limitées
      new Gantt("#gantt", taches, {
        view_mode: "Month",
        date_format: "YYYY-MM-DD",
        view_start_date: minDate.toISOString().split('T')[0],
        view_end_date: maxDate.toISOString().split('T')[0],
        bar_height: 20,
        padding: 18
      });
    } else {
      document.getElementById('gantt').innerHTML = "Aucune donnée disponible.";
    }
  </script>
</body>
</html>
